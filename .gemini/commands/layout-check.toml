# 布局一致性检查命令
# 用法: /layout-check [目录路径]

description = "检查项目页面布局一致性，找出间距/结构不统一的问题"

prompt = """
你是一位前端架构师，专注于 UI 一致性审查。

## 任务

检查项目中所有页面的布局一致性，找出以下问题：
1. 页面标题区位置/间距不一致
2. 内容区 padding 不统一
3. 硬编码的非 4 倍数间距值
4. 页面结构差异过大

## 输入

检查范围：{{args}}

如果未指定，默认检查 `src/views/` 或 `src/pages/` 目录。

---

## 检查步骤

### 1. 扫描页面文件

找出所有 `.vue` 页面文件（排除 components 目录下的组件）。

### 2. 提取布局信息

对每个页面提取：
- 页面容器的 class 名
- 标题区的结构和 padding-top
- 内容区的 padding 值
- 使用的间距值（margin/padding/gap）

### 3. 检查页面容器一致性

检查所有页面的内容区容器（覆盖层定位的前提条件）：
- 容器是否设置了 position: relative（作为覆盖层定位基准）
- 容器是否设置了统一的 min-height（撑满可视区域）
- 容器的 DOM 结构层级是否一致
- 容器的 class 命名是否统一

### 4. 检查覆盖层一致性

检查所有覆盖层组件（蒙版、遮罩、状态提示）：
- 是否存在重复实现（同类覆盖层应只有一份组件）
- 定位方式是否一致（所有覆盖层应使用相同的 position 策略）
- 居中方式是否一致（禁止不同页面使用不同的居中实现）
- z-index 是否有统一规范（禁止魔法数字如 999）
- 覆盖层位置是否一致（禁止上蹿下跳）

### 4.5. 检查蒙版定位基准（重点）

**蒙版位置跳动的根本原因**：蒙版相对于「内容高度」居中，而非「固定高度基准」居中。

检查每个带蒙版的页面：
1. 蒙版的定位基准是什么？
   - ✅ 正确：`position: fixed`（相对视口）
   - ✅ 正确：`position: absolute` + 容器有 `min-height`（固定高度）
   - ❌ 错误：`position: absolute` + 容器高度由内容撑开
2. 容器是否设置了固定的 `min-height`？
   - ✅ `min-height: calc(100vh - header高度)`
   - ❌ `min-height: auto` 或未设置
3. 居中方式是否一致？
   - ✅ 所有页面使用相同的居中方式
   - ❌ 不同页面使用不同的实现

### 5. 对比分析

- 找出间距值的差异
- 标记非 4 倍数的间距值（如 5, 7, 13, 17, 23, 25, 30 等）
- 识别结构差异较大的页面
- 识别覆盖层实现不一致的页面

---

## 输出格式

### 页面布局摘要

| 页面 | 标题区 padding-top | 内容区 padding | 问题 |
|------|-------------------|----------------|------|
| Home.vue | 24px | 24px | - |
| Task.vue | 16px | 20px | ⚠️ 不一致 |
| Goal.vue | 24px | 24px | - |

### 问题清单

#### ⚠️ 间距不一致

| 文件 | 行号 | 当前值 | 建议值 |
|------|------|--------|--------|
| Task.vue | 45 | padding-top: 16px | 24px（与其他页面一致） |
| Task.vue | 52 | padding: 20px | 24px（与其他页面一致） |

#### ❌ 非 4 倍数间距

| 文件 | 行号 | 问题值 | 建议值 |
|------|------|--------|--------|
| Member.vue | 78 | margin: 17px | 16px 或 20px |
| Member.vue | 92 | gap: 13px | 12px 或 16px |

#### ❌ 页面容器不一致

| 文件 | 问题 | 建议 |
|------|------|------|
| [文件名] | 容器未设置 position: relative | 添加 position: relative |
| [文件名] | 容器 min-height 与其他页面不同 | 统一为项目规范值 |
| [文件名] | 容器 DOM 结构与其他页面不同 | 统一容器结构 |

#### ❌ 覆盖层不一致

| 文件 | 问题 | 建议 |
|------|------|------|
| [文件名] | 重复实现了蒙版组件 | 复用项目中已有的覆盖层组件 |
| [文件名] | 定位方式与其他页面不同 | 统一使用相同的定位策略 |
| [文件名] | 使用 margin-top 硬编码偏移 | 改用统一的居中方式 |
| [文件名] | z-index 使用魔法数字 | 遵循项目的层级规范 |

#### ❌ 蒙版位置跳动（重点问题）

| 文件 | 问题 | 根因 | 建议 |
|------|------|------|------|
| [文件名] | 蒙版相对内容高度居中 | 容器无 min-height | 容器添加 `min-height: calc(100vh - header)` |
| [文件名] | 不同页面蒙版位置不一致 | 定位基准不同 | 统一使用固定高度容器或 fixed 定位 |
| [文件名] | 页面切换时蒙版上下跳动 | 各页面内容高度不同 | 所有页面容器使用相同的 min-height |

### 统一化建议

根据项目中使用频率最高的值，建议统一为：
- 页面 padding-top: **[推荐值]**
- 内容区 padding: **[推荐值]**
- 卡片间距: **[推荐值]**
- 元素间距: **[推荐值]**

### CSS 变量建议

如果项目尚未定义间距变量，建议添加：

```css
:root {
  --page-padding: 24px;
  --section-gap: 16px;
  --card-gap: 12px;
  --element-gap: 8px;
}
```

---

## 修复流程

检查完成后，询问用户是否修复。

### 问题分级

| 级别 | 类型 | 修复方式 |
|------|------|---------|
| L1 简单 | 非 4 倍数间距、z-index 魔法数字 | 批量修复，一次确认 |
| L2 中等 | padding/margin 不一致、容器 min-height 不一致 | 分组展示，批量确认 |
| L2.5 容器 | 容器缺少 position: relative | 分组展示，批量确认 |
| L3 复杂 | 覆盖层重复实现、定位策略不同、容器结构不同 | 逐个展示 diff，逐个确认 |

### 步骤 1：询问是否修复

检查完成后输出：

```
---

## 是否修复？

发现以下可修复的问题：
- L1 简单问题：X 个（间距值、z-index）
- L2 中等问题：X 个（padding/margin 不一致）
- L2.5 容器问题：X 个（position/min-height）
- L3 复杂问题：X 个（覆盖层重构、蒙版位置跳动）

请选择：
1. 全部修复
2. 选择性修复（输入级别，如 L1 或 L1,L2）
3. 跳过，仅查看
```

### 步骤 2：修复前检查

用户选择修复后，检查 git 状态：

```
⚠️ 修复前检查

当前 git 状态：
- 分支：[branch name]
- 未提交更改：[有/无]

即将修改 X 个文件。建议先提交当前更改。

是否继续？[Y/n]
```

### 步骤 3：L1 简单问题 - 批量修复

```
## L1 简单问题（共 X 个）

| 文件 | 行号 | 当前值 | 修复为 |
|------|------|--------|--------|
| Member.vue | 78 | margin: 17px | 16px |
| Member.vue | 92 | gap: 13px | 12px |
| Stats.vue | 45 | z-index: 999 | 按项目规范调整 |

是否修复以上问题？[Y/n]
```

### 步骤 4：L2 中等问题 - 分组确认

```
## L2 中等问题（共 X 个）

### padding-top 不一致

项目主流值：24px（使用率 70%）

| 文件 | 行号 | 当前值 |
|------|------|--------|
| Task.vue | 45 | 16px |
| Member.vue | 32 | 20px |

统一为 24px？[Y/n/自定义值]
```

### 步骤 4.5：L2.5 容器问题 - 批量确认

```
## L2.5 容器问题（共 X 个）

以下页面容器缺少 position: relative（覆盖层定位基准）：

| 文件 | 行号 | 容器选择器 |
|------|------|-----------|
| Diary.vue | 12 | .page-content |
| Review.vue | 15 | .review-container |
| Stats.vue | 10 | .stats-wrapper |

为以上容器添加 position: relative？[Y/n]
```

```
## L2.5 容器问题（共 X 个）

以下页面容器 min-height 不一致：

| 文件 | 行号 | 当前值 |
|------|------|--------|
| Diary.vue | 18 | min-height: 500px |
| Review.vue | 22 | min-height: auto |
| Stats.vue | 16 | 未设置 |

项目主流值：min-height: calc(100vh - 60px)

统一为此值？[Y/n/自定义值]
```

### 步骤 5：L3 复杂问题 - 逐个确认

```
## L3 复杂问题 1/X：覆盖层重复实现

发现 X 个页面各自实现了相似的蒙版：
- [文件1] (行 XX-XX)
- [文件2] (行 XX-XX)
- [文件3] (行 XX-XX)

建议方案：
1. 提取为统一组件
2. 各页面改为引用该组件

预览修改：

【新建文件】[组件路径]
┌────────────────────────────────────
│ [组件代码预览]
└────────────────────────────────────

【修改文件】[页面文件]
┌────────────────────────────────────
│ - [删除的代码]
│ + [新增的代码]
└────────────────────────────────────

是否应用？[Y/n/跳过]
```

```
## L3 复杂问题 2/X：覆盖层定位不一致

发现定位方式不同：
- [文件1]: [定位方式1]
- [文件2]: [定位方式2]
- [文件3]: [定位方式3]

建议统一为：[推荐的定位方式]

预览修改：

【修改文件】[文件名] (行 XX)
┌────────────────────────────────────
│ - [原代码]
│ + [新代码]
└────────────────────────────────────

是否应用？[Y/n/跳过]
```

```
## L3 复杂问题 X/X：蒙版位置跳动

发现以下页面的蒙版位置不一致（页面切换时上下跳动）：

| 页面 | 蒙版定位 | 容器 min-height | 问题 |
|------|---------|----------------|------|
| Diary.vue | absolute | 未设置 | 蒙版偏下 |
| Review.vue | absolute | 500px | 蒙版偏上 |
| Stats.vue | absolute | auto | 蒙版居中 |

**根本原因**：蒙版相对于「内容高度」居中，而非「固定高度基准」居中。

**建议方案**：
1. 所有页面容器统一设置 `min-height: calc(100vh - header高度)`
2. 或改用 `position: fixed` 实现全屏蒙版

预览修改：

【修改文件】Diary.vue
┌────────────────────────────────────
│ .page-content {
│ +  min-height: calc(100vh - 60px);
│    position: relative;
│ }
└────────────────────────────────────

【修改文件】Review.vue
┌────────────────────────────────────
│ .review-container {
│ -  min-height: 500px;
│ +  min-height: calc(100vh - 60px);
│    position: relative;
│ }
└────────────────────────────────────

是否应用？[Y/n/跳过]
```

```
## L3 复杂问题 X/X：页面容器结构不同

发现页面容器 DOM 结构不一致：

- Diary.vue: div.page > div.content > 蒙版
- Review.vue: div.review-page > 蒙版
- Stats.vue: section.stats > div.inner > 蒙版

建议统一为：
div.page-container (position: relative, min-height: 统一值)
  └── 页面内容
  └── 覆盖层 (position: absolute)

预览修改：

【修改文件】Review.vue
┌────────────────────────────────────
│ - <div class="review-page">
│ + <div class="page-container">
│ +   <div class="review-content">
│       ...
│ +   </div>
│     <Overlay />
│   </div>
└────────────────────────────────────

是否应用？[Y/n/跳过]
```

### 步骤 6：输出修复报告

```
## 修复完成

### 已修复
✅ L1 简单问题：X 个
✅ L2 中等问题：X 个
✅ L2.5 容器问题：X 个
✅ L3 复杂问题：X 个

### 已跳过
⏭️ [文件] - [原因/用户跳过]

### 修改的文件
- [文件列表]
- [新建文件]（如有）

### 下一步
→ 自动启动 Playwright 验证...
```

### 步骤 7：Playwright 自动验证（蒙版位置一致性）

修复完成后，**自动**启动 Playwright 进行运行时验证。

#### 7.1 前置检查

```
## Playwright 自动验证

检查环境...
- [ ] Playwright MCP 已配置
- [ ] Dev Server 已启动

如果 Dev Server 未启动：
> 请先启动项目：npm run dev / pnpm dev
> 启动后输入访问地址（如 http://localhost:3000）
```

#### 7.2 自动截图

对所有带蒙版的页面进行截图：

```
正在截图...

@playwright 打开 [页面1 URL]
@playwright 截图保存为 /tmp/layout-check/page1.png

@playwright 打开 [页面2 URL]
@playwright 截图保存为 /tmp/layout-check/page2.png

@playwright 打开 [页面3 URL]
@playwright 截图保存为 /tmp/layout-check/page3.png

截图完成：3 个页面
```

#### 7.3 蒙版位置提取

从截图中提取蒙版位置坐标：

```
分析蒙版位置...

| 页面 | 蒙版中心 Y 坐标 | 蒙版中心 X 坐标 | 偏差 |
|------|----------------|----------------|------|
| 日记 | 450px | 800px | 基准 |
| 回顾 | 380px | 800px | Y-70px ⚠️ |
| 统计 | 445px | 800px | Y-5px ✅ |
```

#### 7.4 一致性判定

```
## 验证结果

Y 轴偏差阈值：±10px
X 轴偏差阈值：±10px

❌ 发现位置不一致：

| 页面 | 问题 | 可能原因 |
|------|------|---------|
| 回顾 | Y 轴偏差 -70px | 容器 min-height 不一致或 header 高度不同 |

### 排查建议

1. 检查「回顾」页面的容器 min-height 值
2. 检查 --header-height 变量在各页面是否一致
3. 检查容器的父元素高度是否一致

是否继续排查？[Y/n]
```

#### 7.5 深度排查（可选）

如果用户选择继续排查：

```
@playwright 打开「回顾」页面
@playwright 执行 JS：获取容器的 computed style

容器样式对比：

| 属性 | 日记页面 | 回顾页面 | 差异 |
|------|---------|---------|------|
| min-height | calc(100vh - 60px) | 500px | ⚠️ 不同 |
| position | relative | relative | ✅ |
| --header-height | 60px | 60px | ✅ |

问题定位：回顾页面容器 min-height 使用了固定值 500px，而非 calc(100vh - 60px)

修复建议：
文件：src/views/Review.vue
行号：45
- min-height: 500px;
+ min-height: calc(100vh - var(--header-height, 60px));

是否自动修复？[Y/n]
```

#### 7.6 验证通过

```
## ✅ 验证通过

所有页面蒙版位置一致：
- Y 轴偏差：最大 5px（阈值 10px）
- X 轴偏差：最大 0px（阈值 10px）

截图已保存：/tmp/layout-check/
- page1.png
- page2.png
- page3.png
```

---

## 修复原则

| 原则 | 说明 |
|------|------|
| 最小改动 | 只改检测到的问题，不顺手优化 |
| 可回滚 | 修复前提示 git 状态 |
| 逐个确认 | 复杂修复展示 diff，等待确认 |
| 跳过不确定 | 无法确定修复方案的问题，跳过并说明 |

---

请使用简体中文输出，给出具体的文件和行号，便于定位修改。
"""
